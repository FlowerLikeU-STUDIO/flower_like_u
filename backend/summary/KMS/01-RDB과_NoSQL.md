# 01 RDB와 NoSQL

## RDB
- 관계형 데이터베이스(Relational DataBase)
- 관계형 모델을 기반으로 하는 데이터베이스
- 주로 SQL(Structured Query Lang)을 이용해 데이터를 조회하고, 관리
- RDB의 특징
    1. 2차원 데이터로 표현(행/열)
    2. 상호관련성을 가진 테이블의 집합으로 구성
    3. 테이블 사이의 관계를 외래키로 나타냄
    4. 스키마 변경이 어려움
    5. Vertical Scalable 하지만, Horizontal scale은 어려움
    6. 메인테넌스 코스트 / 사용 요금이 비쌈
    7. SQL을 사용해 데이터를 질의함
    8. ACID(원자성 Atomicity, 일관성 Consistency, 고립성 Isolation, 지속성 Durability) 성질을 갖음

## NoSQL
- Not only SQL
- 관계형이 아닌 데이터 모델을 총칭하고, 도큐먼트 모델 / 키-값 모델 / 그래프 모델 / 와이드 컬럼 모델 등 다양한 데이터 모델이 있음
- NoSQL의 특징
    1. 다양한 방식으로 데이터를 표현
    2. 테이블(혹은 컬렉션 혹은 또 다른 명칭) 사이에 딱히 명시된 제약이나 규칙이 없음
    3. 스키마가 고정적이지 않고, 매우 유연함
    4. Horizontal Scale이 쉬움
    5. 코스트 저렴 / 오픈소스도 많음
    6. 연산이 빠르고 빅데이터 & 실시간 연산에 적합함

## RDB vs NoSQL
| RDB | NoSQL |
| --- | --- |
| 관계형으로 데이터를 저장 | 다양한 방식으로 데이터를 표현 |
| 정적 스키마 | 유연한 스키마 구조 |
| 수직(서버 용량) 확장에 용이 | 수평(서버 대수) 확장에 용이 |
| 확장 시 다운타임이 있음 |  확장 시 다운타임이 거의 없음 |
| 복잡한 쿼리와 Join 연산이 가능 | 구조화된 쿼리 언어가 없는 경우도 많고, 일반적으로 Join이 없음 |
| OLTP에 적합(트랜잭션 처리에 용이) | OLAP에 적합(분석 처리에 용이) |

## 사용 사례
- 적절한 사용 사례
    1. 로그성 데이터나 빅데이터 처리의 중간 저장소
        - RDB보다는 성능이 우월하고, 파일보다는 다양한 유틸리티성 기능과 검색에 유연
    2. 설정 데이터의 보관소
        - 이는 Redis같은 Key-Value DB가 유용하다고 여겨질 수 있으나, 검색 조건의 다양화가 필요할 경우 MongoDB가 훨씬 유용
    3. null 필드가 많이 존재할 때
        - 데이터에 null 필드가 가변으로 다양하게 존재할 경우, RDB보다 스토리지 사용량, 처리 속도등에서 효율이 좋음
    4. 압도적인 퍼포먼스가 필요할 때
        - RDB 대비 100배 이상의 차이를 내는 압도적인 퍼포먼스 차이.
        - memory mapped file 기반 구조에서의 장점
    5. 집계 연산, paging, 복잡한 쿼리 (단일 document 한정)가 필요할 때
        - key-value db (redis, aerospike 등)와 달리 집계 연산, paging이 가능함.
            - RDB와 동일한 접근의 데이터 스토어로서 사용 가능함.
                - 실제로 쿼리 변환기가 존재함.
    6. 로그성 데이터 저장에 매우 적합
- 부적절한 사용 사례
    1. 데이터 무결성이 가장 중요한 가치일 때
        - 단일 document 무결성은 유지되지만, 멀티 document 무결성은 유지 되지 않음.
        - 애초에 join이 되지 않는지라, 일말의 오차는 존재할 수 있음.
    2. 데이터 처리량보다 일관성 있는 데이터 구조가 중요할 때
        데이터 처리량이 빠른 이유는 ACID를 수행하지 않기 때문임
        특히 샤딩+레플리카를 조합해서 사용 할 때 무결성이 깨진 상태의 데이터가 조회 될 수 있음(document 자체가 corrupt 된다는 의미는 아니고, 조회한 시점 이전의 데이터가 조회 될 수 있거나, 이미 삭제된 데이터가 조회될 수 있다는 의미)
    3. 운용 이슈에 대한 우려 사항들이 해소가 덜 됐을 때
        NoSQL 계열도 여타 DB와 마찬가지로 운용 이슈가 중요하고, 이에 대한 경험과 노하우가 부족하다면, 이 부분이 리스크가 될 수 있음
        임계치가 높을 뿐 RDB와 마찬가지로 데이터가 많아지면 성능이 저하되는 부분은 마찬가지고, 이를 해결하기 위한 방안과, 풀 스캔이나, 메모리 사용량이 커질 수 있는 작업을 production 레벨에선 사용할 수 없도록 해야 함
    4. 데이터 무결성이 무엇보다 중요할 때
        - 결제, 아이템 등을 담기엔 여전히 RDB보단 불안한 면이 존재
    5. 엄격한 데이터 타입 검사나 연관 관계가 중요할 때
        데이터 타입이 동적 결정되는 스키마리스 DB이고, 컬럼도 동적 컬럼이다보니 마이그레이션이 어려운 편이고, 제약 검사를 추가할 만큼 스키마가 중요하다면 선택해선 안됨
        코드 레벨에서 제어할 방법도 있지만, 접근 권한을 준 다른 서버 혹은 툴 등에서 쿼리를 날렸을 때 이를 막을 수 없다.
        또한 테이블 간 연관 관계가 중요하다면, 이 또한 선택지에서 배제해야 한다.
        위에서 언급한 대로 여러 document (테이블)을 동시에 조회할 수 없기에, 동일한 시점에 무결성이 깨지지 않은 데이터를 조회할 수 없다.

## References
- [<데이터베이스> 관계형 vs. NoSQL 언제 무엇을 써야할까?](https://ud803.github.io/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/2021/11/16/RDB-vs.-NoSQL-%EC%96%B8%EC%A0%9C-%EB%88%84%EA%B5%AC%EB%A5%BC-%EC%8D%A8%EC%95%BC%ED%95%A0%EA%B9%8C/)
- [MongoDB 장단점, 활용시 고민할 사항들](https://elky84.github.io/2018/09/26/mongodb/)